name: Hardware-in-the-Loop Tests

on:
  push:
    branches: [ main ]
  pull_request:
  schedule:
    # Run workflow at the start of every day (12 AM UTC)
    - cron: "0 0 * * *"
  workflow_dispatch:

jobs:
  hil_test_zephyr:
    strategy:
      fail-fast: false
      matrix:
        include:
          - hil_board: esp32_devkitc_wrover
            west_board: esp32_devkitc_wrover
            manifest: .ci-west-zephyr.yml
            binary_name: merged.bin
            binary_blob: hal_espressif
          - hil_board: mimxrt1024_evk
            west_board: mimxrt1024_evk
            manifest: .ci-west-zephyr.yml
            binary_name: zephyr.hex
          - hil_board: nrf52840dk
            west_board: nrf52840dk_nrf52840
            manifest: .ci-west-zephyr.yml
            binary_name: zephyr.hex
          # - hil_board: nrf9160dk
          #   west_board: nrf9160dk_nrf9160_ns
          #   manifest: .ci-west-ncs.yml
          #   binary_name: merged.hex
    uses: ./.github/workflows/hil_test_zephyr.yml
    with:
      hil_board: ${{ matrix.hil_board }}
      west_board: ${{ matrix.west_board }}
      manifest: ${{ matrix.manifest }}
      binary_name: ${{ matrix.binary_name}}
      binary_blob: ${{ matrix.binary_blob }}
    secrets: inherit

  hil_test_esp-idf:
    strategy:
      fail-fast: false
      matrix:
        include:
          - hil_board: esp32s3_devkitc
            idf_target: esp32s3
          - hil_board: esp32_devkitc_wrover
            idf_target: esp32
          - hil_board: esp32c3_devkitm
            idf_target: esp32c3
    uses: ./.github/workflows/hil_test_esp-idf.yml
    with:
      hil_board: ${{ matrix.hil_board }}
      idf_target: ${{ matrix.idf_target }}
    secrets: inherit

  hil_sample_zephyr:
    strategy:
      fail-fast: false
      matrix:
        include:
          - hil_board: esp32_devkitc_wrover
            west_board: esp32_devkitc_wrover
            manifest: .ci-west-zephyr.yml
            binary_blob: hal_espressif
            run_tests: false

          - hil_board: mimxrt1024_evk
            west_board: mimxrt1024_evk
            manifest: .ci-west-zephyr.yml
            run_tests: true

          - hil_board: nrf52840dk
            west_board: nrf52840dk_nrf52840
            manifest: .ci-west-zephyr.yml
            run_tests: true

          - hil_board: nrf9160dk
            west_board: nrf9160dk_nrf9160_ns
            manifest: .ci-west-ncs.yml
            run_tests: false

          - hil_board: qemu_x86
            west_board: qemu_x86
            manifest: .ci-west-zephyr.yml
            run_tests: false
    uses: ./.github/workflows/hil_sample_zephyr.yml
    with:
      hil_board: ${{ matrix.hil_board }}
      west_board: ${{ matrix.west_board }}
      manifest: ${{ matrix.manifest }}
      binary_blob: ${{ matrix.binary_blob }}
      run_tests: ${{ matrix.run_tests }}
    secrets: inherit
