From eadce497df28e648f9d6a0b6f518fc0eca6ee9d7 Mon Sep 17 00:00:00 2001
From: Mike Szczys <mike@golioth.io>
Date: Fri, 2 Jan 2026 11:16:29 -0600
Subject: [PATCH] twister: honor --keep-artifacts when using
 ----prep-artifacts-for-testing

Signed-off-by: Mike Szczys <mike@golioth.io>
---
 scripts/pylib/twister/twisterlib/runner.py | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/scripts/pylib/twister/twisterlib/runner.py b/scripts/pylib/twister/twisterlib/runner.py
index f366c1029df..71a52d75939 100644
--- a/scripts/pylib/twister/twisterlib/runner.py
+++ b/scripts/pylib/twister/twisterlib/runner.py
@@ -1197,7 +1197,7 @@ class ProjectBuilder(FilterBuilder):
                     mode == "passed"
                     or (mode == "all" and self.instance.reason != "CMake build failure")
                 ):
-                    self.cleanup_artifacts(self.options.keep_artifacts)
+                    self.cleanup_artifacts()
             except StatusAttributeError as sae:
                 logger.error(str(sae))
                 self.instance.status = TwisterStatus.ERROR
@@ -1313,6 +1313,7 @@ class ProjectBuilder(FilterBuilder):
             ]
 
         allow += additional_keep
+        allow += self.options.keep_artifacts
 
         if self.options.runtime_artifact_cleanup == 'all':
             allow += [os.path.join('twister', 'testsuite_extra.conf')]
-- 
2.52.0

